<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.489">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Edgar Allan Poe">

<title>The Tell-Tale Heart</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#notation" id="toc-notation" class="nav-link active" data-scroll-target="#notation">Notation</a></li>
  <li><a href="#notes" id="toc-notes" class="nav-link" data-scroll-target="#notes">Notes</a></li>
  <li><a href="#scenes" id="toc-scenes" class="nav-link" data-scroll-target="#scenes">Scenes</a>
  <ul class="collapse">
  <li><a href="#opening" id="toc-opening" class="nav-link" data-scroll-target="#opening">Opening</a></li>
  <li><a href="#scene-1-self-introduction" id="toc-scene-1-self-introduction" class="nav-link" data-scroll-target="#scene-1-self-introduction">Scene 1: Self-introduction</a></li>
  <li><a href="#scene-2-build-up" id="toc-scene-2-build-up" class="nav-link" data-scroll-target="#scene-2-build-up">Scene 2: Build-up</a></li>
  <li><a href="#scene-3-the-8th-night" id="toc-scene-3-the-8th-night" class="nav-link" data-scroll-target="#scene-3-the-8th-night">Scene 3: The 8th night</a></li>
  <li><a href="#scene-4-hiding-the-body" id="toc-scene-4-hiding-the-body" class="nav-link" data-scroll-target="#scene-4-hiding-the-body">Scene 4: Hiding the body</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Tell-Tale Heart</h1>
<p class="subtitle lead">As a stage play</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Edgar Allan Poe </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="notation" class="level1">
<h1>Notation</h1>
<ul>
<li>MC = Main Character (1)</li>
<li>PC = Physical Cast (3)</li>
</ul>
<p><em>Stage directions</em></p>
<blockquote class="blockquote">
<p>The choir (physical cast) unisono, also unisone with MC if they have the same words written before.</p>
</blockquote>
</section>
<section id="notes" class="level1">
<h1>Notes</h1>
<p>Blocking: Main actor center stage, towards the audience, PC behind, maybe next to them.</p>
<p>One PC member represents the main actor in their story: PC1</p>
<p>Two others alternate between the two police officers and whatever is needed in the scene (e.g.&nbsp;the old man, bed, eye, a representation of mortal terror)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>PC instructions are not final. They are prompts for workshopping.</p>
</div>
</div>
<p>Heartbeat sound:</p>
<audio controls="" loop="" preload="auto">
<source src="data/heartbeat.wav" type="audio/wav">
</audio>
<p>Heartbeat sound, 80% speed:</p>
<audio controls="" loop="" preload="auto">
<source src="data/heartbeat-80perc.wav" type="audio/wav">
</audio>
<p>Heartbeat sound, 50% speed:</p>
<audio controls="" loop="" preload="auto">
<source src="data/heartbeat-50perc.wav" type="audio/wav">
</audio>
</section>
<section id="scenes" class="level1">
<h1>Scenes</h1>
<section id="opening" class="level2">
<h2 class="anchored" data-anchor-id="opening">Opening</h2>
<p><em>Character is led onto stage by PC2,3 as if in handcuffs, is being sat onto a chair (the only prop on stage). The character is then left alone on stage.</em></p>
</section>
<section id="scene-1-self-introduction" class="level2">
<h2 class="anchored" data-anchor-id="scene-1-self-introduction">Scene 1: Self-introduction</h2>
<p>TRUE! – nervous – very, very dreadfully nervous I had been and am; but why will you say that I am mad? The disease had sharpened my senses – not destroyed – not dulled them. Above all was the sense of hearing acute. I heard all things in the heaven and in the earth. I heard many things in hell. How, then, am I mad?</p>
<p>Hearken!</p>
<blockquote class="blockquote">
<p>Hearken!</p>
</blockquote>
<p><em>PC encircle the main actor as demons escaping from hell, crawling, threatening, haunting.</em></p>
<p>and observe how healthily – how calmly I can tell you the whole story.</p>
</section>
<section id="scene-2-build-up" class="level2">
<h2 class="anchored" data-anchor-id="scene-2-build-up">Scene 2: Build-up</h2>
<p>It is impossible to say how first the idea entered my brain; but once conceived, it haunted me day and night. Object there was none. Passion there was none. I loved the old man. He had never wronged me. He had never given me insult. For his gold I had no desire. I think it was his eye! yes, it was this! He had the eye of a vulture – a pale blue eye, with a film over it. Whenever it fell upon me, my blood ran cold; and so by degrees – very gradually – I made up my mind to take the life of the old man, and thus rid myself of the eye forever.</p>
<p>Now this is the point. You fancy me mad. Madmen know nothing. But you should have seen me. You should have seen how wisely I proceeded – with what caution – with what foresight – with what dissimulation I went to work!</p>
<p><em>PC1 with gentleman-like gestures, assisting PC2 as the old man</em></p>
<p>I was never kinder to the old man than during the whole week before I killed him. And every night, about midnight, I turned the latch of his door and opened it – oh so gently! And then, when I had made an opening sufficient for my head, I put in a dark lantern, all closed, closed, so that no light shone out, and then I thrust in my head. Oh, you would have laughed to see how cunningly I thrust it in!</p>
<p><em>PC move around in slow motion</em></p>
<p>I moved it slowly – very, very slowly, so that I might not disturb the old man’s sleep. It took me an hour to place my whole head within the opening so far that I could see him as he lay upon his bed. Ha! – would a madman have been so wise as this?</p>
<blockquote class="blockquote">
<p>No!</p>
</blockquote>
<p>And then, when my head was well in the room, I undid the lantern cautiously – oh, so cautiously – cautiously (for the hinges creaked) – I undid it just so much that a single thin ray fell upon the vulture eye.</p>
<p><em>Spotlight onto a PC member on a “bed”, PC1 looking over</em></p>
<p>And this I did for seven long nights – every night just at midnight – but I found the eye always closed; and so it was impossible to do the work; for it was not the old man who vexed me, but his Evil Eye.</p>
<p><em>PC1 with gentleman-like gestures, assisting PC2 as the old man</em></p>
<p>And every morning, when the day broke, I went boldly into the chamber, and spoke courageously to him, calling him by name in a hearty tone, and inquiring how he has passed the night. So you see he would have been a very profound old man, indeed, to suspect that every night, just at twelve, I looked in upon him while he slept.</p>
</section>
<section id="scene-3-the-8th-night" class="level2">
<h2 class="anchored" data-anchor-id="scene-3-the-8th-night">Scene 3: The 8th night</h2>
<p>Upon the eighth night I was more than usually cautious in opening the door. A watch’s minute hand moves more quickly than did mine. Never before that night had I felt the extent of my own powers – of my sagacity. I could scarcely contain my feelings of triumph. To think that there I was, opening the door, little by little, and he not even to dream of my secret deeds or thoughts. I fairly chuckled at the idea; and perhaps he heard me; for he moved on the bed suddenly, as if startled. Now you may think that I drew back – but no. His room was as black as pitch with the thick darkness, (for the shutters were close fastened, through fear of robbers,) and so I knew that he could not see the opening of the door, and I kept pushing it on steadily, steadily.</p>
<p>I had my head in, and was about to open the lantern, when my thumb slipped upon the tin fastening, and the old man sprang up in bed, crying out –</p>
<p>“Who’s there?</p>
<blockquote class="blockquote">
<p>Who’s there?</p>
</blockquote>
<p>I kept quite still and said nothing. For a whole hour I did not move a muscle, and in the meantime I did not hear him lie down. He was still sitting up in the bed listening; – just as I have done, night after night, hearkening to the death watches in the wall.</p>
<p>Presently I heard a slight groan, and I knew it was the groan of mortal terror.</p>
<blockquote class="blockquote">
<p><em>Groan, terrifying sounds</em></p>
</blockquote>
<p>It was not a groan of pain or of grief – oh, no! – it was the low stifled sound that arises from the bottom of the soul when overcharged with awe. I knew the sound well.</p>
<p><em>Heartbeat sound, very slow, quiet</em></p>
<p><em>PC with haunting movements, in sync with the heartbeat sound</em></p>
<p>Many a night, just at midnight, when all the world slept, it has welled up from my own bosom, deepening, with its dreadful echo, the terrors that distracted me.</p>
<!--
I say I knew it well.
I knew what the old man felt, and pitied him, although I chuckled at heart.
I knew that he had been lying awake ever since the first slight noise, when he had turned in the bed.
His fears had been ever since growing upon him.
He had been trying to fancy them causeless, but could not.
He had been saying to himself -- "It is nothing but the wind in the chimney -- it is only a mouse crossing the floor," or "It is merely a cricket which has made a single chirp.
Yes, he had been trying to comfort himself with these suppositions: but he had found all in vain.
All in vain; because Death, in approaching him had stalked with his black shadow before him, and enveloped the victim.
And it was the mournful influence of the unperceived shadow that caused him to feel -- although he neither saw nor heard -- to feel the presence of my head within the room.
-->
<p>When I had waited a long time, very patiently, without hearing him lie down, I resolved to open a little – a very, very little crevice in the lantern. So I opened it – you cannot imagine how stealthily, stealthily – until, at length a single dim ray, like the thread of the spider, shot from out the crevice and fell full upon the vulture eye.</p>
<p><em>Spotlight, old man, bed, eyes wide open (maybe play with perspective and move the “bed” to a vertical position)</em></p>
<p>It was open – wide, wide open – and I grew furious as I gazed upon it. I saw it with perfect distinctness –all a dull blue, with a hideous veil over it that chilled the very marrow in my bones; but I could see nothing else of the old man’s face or person: for I had directed the ray as if by instinct, precisely upon the damned spot.</p>
<p>And have I not told you that what you mistake for madness is but over acuteness of the senses? – now, I say, there came to my ears a low, dull, quick sound, such as a watch makes when enveloped in cotton.</p>
<p><em>Heartbeat sound intensifies, slightly faster, louder</em></p>
<p>I knew that sound well, too. It was the beating of the old man’s heart. It increased my fury, as the beating of a drum stimulates the soldier into courage.</p>
<p><em>PC move around frantically, angry, in sync with the heartbeat sound</em></p>
<!--
But even yet I refrained and kept still.
I scarcely breathed.
I held the lantern motionless.
I tried how steadily I could maintain the ray upon the eye.
Meantime the hellish tattoo of the heart increased.
It grew quicker and quicker, and louder and louder every instant.
The old man's terror must have been extreme!
It grew louder, I say, louder every moment!
-- do you mark me well?
I have told you that I am nervous: so I am.
And now at the dead hour of the night, amid the dreadful silence of that old house, so strange a noise as this excited me to uncontrollable terror.
Yet, for some minutes longer I refrained and stood still.
But the beating grew louder, louder!
I thought the heart must burst.
And now a new anxiety seized me -- the sound would be heard by a neighbor!
-->
<p><em>PC re-enact the words of MC</em></p>
<p>The old man’s hour had come! With a loud yell, I threw open the lantern and leaped into the room. He shrieked once – once only. In an instant I dragged him to the floor, and pulled the heavy bed over him. I then smiled gaily, to find the deed so far done. But, for many minutes, the heart beat on with a muffled sound. This, however, did not vex me; it would not be heard through the wall. At length it ceased.</p>
<p><em>Heartbeat sound stops</em></p>
<p>The old man was dead. I removed the bed and examined the corpse. Yes, he was stone, stone dead. I placed my hand upon the heart and held it there many minutes. There was no pulsation. He was stone dead. His eye would trouble me no more.</p>
<p><em>PC fade into the background</em></p>
</section>
<section id="scene-4-hiding-the-body" class="level2">
<h2 class="anchored" data-anchor-id="scene-4-hiding-the-body">Scene 4: Hiding the body</h2>
<p>If still you think me mad, you will think so no longer when I describe the wise precautions I took for the concealment of the body. The night waned, and I worked hastily, but in silence. First of all I dismembered the corpse. I cut off the head and the arms and the legs.</p>
<p>I then took up three planks from the flooring of the chamber, and deposited all between the scantlings. I then replaced the boards so cleverly, so cunningly, that no human eye – not even his –could have detected any thing wrong. There was nothing to wash out – no stain of any kind – no blood-spot whatever. I had been too wary for that. A tub had caught all – ha! ha!</p>
<p>When I had made an end of these labors, it was four o’clock – still dark as midnight. As the bell sounded the hour, there came a knocking at the street door. I went down to open it with a light heart, – for what had I now to fear? There entered two men, who introduced themselves, with perfect suavity, as officers of the police. A shriek had been heard by a neighbor during the night; suspicion of foul play had been aroused; information had been lodged at the police office, and they (the officers) had been deputed to search the premises.</p>
<p>I smiled, – for what had I to fear? I bade the gentlemen welcome. The shriek, I said, was my own in a dream. The old man, I mentioned, was absent in the country. I took my visitors all over the house. I bade them search – search well. I led them, at length, to his chamber. I showed them his treasures, secure, undisturbed. In the enthusiasm of my confidence, I brought chairs into the room, and desired them here to rest from their fatigues, while I myself, in the wild audacity of my perfect triumph, placed my own seat upon the very spot beneath which reposed the corpse of the victim.</p>
<p><em>Heartbeat sound starts again, quietly</em></p>
<p>The officers were satisfied. My manner had convinced them. I was singularly at ease. They sat, and while I answered cheerily, they chatted of familiar things. But, ere long, I felt myself getting pale and wished them gone. My head ached, and I fancied a ringing in my ears: but still they sat and still chatted. The ringing became more distinct: – it continued and became more distinct: I talked more freely to get rid of the feeling: but it continued and gained definiteness – until, at length, I found that the noise was not within my ears.</p>
<p>No doubt I now grew very pale; – but I talked more fluently, and with a heightened voice. Yet the sound increased – and what could I do? It was a low, dull, quick sound – much such a sound as a watch makes when enveloped in cotton.</p>
<p><em>Heartbeat sound gets louder</em></p>
<p>I gasped for breath – and yet the officers heard it not. I talked more quickly – more vehemently; but the noise steadily increased. I arose and argued about trifles, in a high key and with violent gesticulations; but the noise steadily increased.</p>
<p><em>MC themselves does not move, but PC1 mirrors the words with movements.</em></p>
<p>Why would they not be gone? I paced the floor to and fro with heavy strides, as if excited to fury by the observations of the men – but the noise steadily increased. Oh God! what could I do? I foamed – I raved – I swore! I swung the chair upon which I had been sitting, and grated it upon the boards, but the noise arose over all and continually increased. It grew louder – louder – louder! And still the men chatted pleasantly, and smiled. Was it possible they heard not? Almighty God! – no, no! They heard! – they suspected! – they knew! – they were making a mockery of my horror! – this I thought, and this I think. But anything was better than this agony! Anything was more tolerable than this derision! I could bear those hypocritical smiles no longer! I felt that I must scream or die! – and now – again! – hark!</p>
<p>louder! louder! louder! louder!</p>
<blockquote class="blockquote">
<p>louder! louder! louder! louder!</p>
</blockquote>
<p>“Villains!” I shrieked, “dissemble no more! I admit the deed! – tear up the planks! – here, here! – it is the beating of his hideous heart!”</p>
<p><em>PC2,3 step forward as police officers, grab MC, sit them back onto the chair (repeat of opening). PC1 fades backwards. Lights off.</em></p>
<p><em>Heartbeat sound stops</em></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>